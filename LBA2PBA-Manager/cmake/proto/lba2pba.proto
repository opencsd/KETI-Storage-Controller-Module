syntax = "proto3";

option java_multiple_files = true;
option java_package = "io.grpc.snippet_sample";
option java_outer_classname = "snippet_sample_Proto";
option objc_class_prefix = "SSP";

package StorageEngineInstance;

service StorageManager {
  rpc RequestPBA (LBARequest) returns (PBAResponse) {}
  rpc RequestVolumeAllocation (VolumeRequest) returns (AllocatedVolumeInfo) {}
}

message Chunk {
  int64 offset = 1;
  int32 length = 2;
}

message ChunkList {
  repeated Chunk chunks = 1;
}

message LBARequest {
  message SST {
    repeated string csd_list = 1;
    map<int32, ChunkList> table_lba_list = 2;
  }
  map<string,SST> sst_block_info = 1;
}

message PBAResponse {
  message CSD {
    map<int32, ChunkList> table_pba_list = 2;
  }
  message SST {
    map<string, CSD> csd_pba_list = 1;
  }
  map<string,SST> sst_block_info = 1;
}


message VolumeRequest{  
  float capacity  = 1;
  int32 using_csd = 2;
}

message AllocatedVolumeInfo {
  message Allocation {
    string csd_id = 1;
    string capacity = 2;
    string partition_name = 3;
  }
  map<string,Allocation> csd_allocation_map = 1;
}